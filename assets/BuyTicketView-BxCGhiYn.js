import{d as $,a as O,r,o as ne,c as S,b as i,f as g,e as m,F,g as c,h as b,l as se,m as L,i as M,u as oe,p as le,t as N}from"./index-CqF_l6GU.js";import{u as ae}from"./stationStore-Do9-x91A.js";import{a as re}from"./function-call-CJ1tGEqk.js";const ie="/yrs/assets/buy-ticket-Cfp8Sjhy.png",ue=$("buyTicketStore",{state:()=>({response:null,error:null,errorMessage:null,errors:[]}),getters:{getResponse:t=>t.response,getError:t=>t.error,getErrorMessage:t=>t.errorMessage,getErrors:t=>t.errors},actions:{async store(t,_,s){var p,o,k,d;try{let u=await O.post("user-portal/buy-ticket",{type:t,origin_station_slug:_,destination_station_slug:s});this.response=u.data??null,this.error=null,this.errorMessage=null,this.errors=[]}catch(u){this.response=null,this.error=u,this.errorMessage=((o=(p=u==null?void 0:u.response)==null?void 0:p.data)==null?void 0:o.message)??null,this.errors=((d=(k=u==null?void 0:u.response)==null?void 0:k.data)==null?void 0:d.errors)??null}}}}),ce=$("ticketPricingStore",{state:()=>({response:null,error:null,errorMessage:null,errors:[]}),getters:{getResponse:t=>t.response,getError:t=>t.error,getErrorMessage:t=>t.errorMessage,getErrors:t=>t.errors},actions:{async get(){var t,_,s,p;try{let o=await O.get("user-portal/ticket-pricing");this.response=o.data??null,this.error=null,this.errorMessage=null,this.errors=[]}catch(o){this.response=null,this.error=o,this.errorMessage=((_=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:_.message)??null,this.errors=((p=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:p.errors)??null}}}}),de={class:"p-3"},ge={class:"bg-white rounded-lg"},pe={class:"pb-3"},ve={key:0,class:"origin-component mx-4 rounded-lg pb-3"},me={key:1,class:"destination-component mx-4 rounded-lg pb-3"},_e={class:"my-4"},be={__name:"BuyTicketView",setup(t){const _=oe(),s=ue(),p=ce(),o=ae(),k=r([]),d=r([]),u=r(1),T=r(null),B=r(!1),P=r(null),x=r(""),y=r(!1),R=r(null),w=r(""),h=r(!1),f=r(null),j=r({type:"",origin_station_slug:"",destination_station_slug:""}),V=r(!1),q=()=>history.back(),z=async()=>{var l;await p.get(),k.value=((l=p.getResponse)==null?void 0:l.data)??[]},C=async()=>{var l,e,a;B.value==!1&&(await o.get({page:u.value,search:""}),d.value.push(...((l=o.getResponse)==null?void 0:l.data)??[]),T.value=((a=(e=o.getResponse)==null?void 0:e.meta)==null?void 0:a.last_page)??null,u.value>=T.value?B.value=!0:u.value++)},A=()=>{y.value=!0,C()},G=({selectedOptions:l})=>{var e,a;P.value=(e=l[0])==null?void 0:e.slug,x.value=(a=l[0])==null?void 0:a.title,y.value=!1},H=({selectedValues:l,selectedOptions:e,selectedIndexes:a,columnIndex:E})=>{var v;((v=d.value[d.value.length-1])==null?void 0:v.slug)==e[0].slug&&C()},J=()=>{h.value=!0,C()},K=({selectedOptions:l})=>{var e,a;R.value=(e=l[0])==null?void 0:e.slug,w.value=(a=l[0])==null?void 0:a.title,h.value=!1},Q=({selectedValues:l,selectedOptions:e,selectedIndexes:a,columnIndex:E})=>{var v;((v=d.value[d.value.length-1])==null?void 0:v.slug)==e[0].slug&&C()},W=async l=>{var e,a;V.value=!0,j.value={type:"",origin_station_slug:"",destination_station_slug:""},await s.store(f.value,P.value,R.value),s.getErrorMessage?s.getErrors&&(j.value={type:s.getErrors.type?s.getErrors.type.join(", "):"",origin_station_slug:s.getErrors.origin_station_slug?s.getErrors.origin_station_slug.join(", "):"",destination_station_slug:s.getErrors.destination_station_slug?s.getErrors.destination_station_slug.join(", "):""}):(re((e=s.getResponse)==null?void 0:e.message),_.push(`ticket/${(a=s.getResponse)==null?void 0:a.data.ticket_number}`)),V.value=!1};return ne(()=>{z()}),(l,e)=>{const a=c("van-nav-bar"),E=c("van-radio"),v=c("van-icon"),X=c("van-cell"),Y=c("van-cell-group"),Z=c("van-radio-group"),I=c("van-field"),U=c("van-picker"),D=c("van-popup"),ee=c("van-button"),te=c("van-form");return b(),S(F,null,[i(a,{title:"Buy Ticket",fixed:!0,"left-text":"","left-arrow":"",onClickLeft:q}),e[9]||(e[9]=g("div",{class:"pt-[46px]"},null,-1)),g("div",de,[i(te,{onSubmit:W},{default:m(()=>[g("div",ge,[e[7]||(e[7]=g("div",{class:"flex justify-center items-center py-3"},[g("img",{src:ie,alt:"",class:"w-5/12"})],-1)),g("div",pe,[i(Z,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=n=>f.value=n)},{default:m(()=>[i(Y,{inset:"",class:"border"},{default:m(()=>[(b(!0),S(F,null,se(k.value,n=>(b(),le(X,{key:n.type,title:n.title,clickable:"",onClick:fe=>f.value=n.type},{"right-icon":m(()=>[i(E,{name:n.type},null,8,["name"])]),label:m(()=>[g("div",null,[g("p",null,[i(v,{name:"diamond-o"}),M(" "+N(n.price),1)]),g("p",null,[i(v,{name:"diamond-o"}),M(" "+N(n.description),1)])])]),_:2},1032,["title","onClick"]))),128))]),_:1})]),_:1},8,["modelValue"])]),f.value=="one_time_ticket"?(b(),S("div",ve,[i(I,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=n=>x.value=n),"is-link":"",readonly:"",label:"Origin",placeholder:"Select Origin",onClick:A,class:"rounded-lg border"},null,8,["modelValue"]),i(D,{show:y.value,"onUpdate:show":e[3]||(e[3]=n=>y.value=n),position:"bottom"},{default:m(()=>[i(U,{title:"Station","confirm-button-text":"Confirm","cancel-button-text":"Cancel",columns:d.value,"columns-field-names":{value:"slug",text:"title"},onConfirm:G,onCancel:e[2]||(e[2]=n=>y.value=!1),onChange:H},null,8,["columns"])]),_:1},8,["show"])])):L("",!0),f.value=="one_time_ticket"?(b(),S("div",me,[i(I,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=n=>w.value=n),"is-link":"",readonly:"",label:"Destination",placeholder:"Select Destination",onClick:J,class:"rounded-lg border"},null,8,["modelValue"]),i(D,{show:h.value,"onUpdate:show":e[6]||(e[6]=n=>h.value=n),position:"bottom"},{default:m(()=>[i(U,{title:"Station","confirm-button-text":"Confirm","cancel-button-text":"Cancel",columns:d.value,"columns-field-names":{value:"slug",text:"title"},onConfirm:K,onCancel:e[5]||(e[5]=n=>h.value=!1),onChange:Q},null,8,["columns"])]),_:1},8,["show"])])):L("",!0)]),g("div",_e,[i(ee,{round:"",block:"",type:"primary","native-type":"submit",color:"#1CBC9B",loading:V.value},{default:m(()=>e[8]||(e[8]=[M(" Confirm ")])),_:1},8,["loading"])])]),_:1})])],64)}}};export{be as default};
